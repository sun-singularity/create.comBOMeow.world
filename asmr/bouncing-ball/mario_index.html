<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bouncing Ball Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <style>
      body {
        transition: background-color 0.5s ease;
        background-color: black;
      }
      canvas {
        background: transparent;
      }
    </style>
  </head>
  <body>
    <button id="start-button">Start Simulation</button>
    <script>
      // Function to initialize the simulation after user interaction
      function initSimulation() {
        // Module aliases
        const Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Events = Matter.Events;

        // Create an engine
        const engine = Engine.create();
        engine.world.gravity.y = 0.5; // Set gravity to half

        // Create a renderer
        const render = Render.create({
          element: document.body,
          engine: engine,
          options: {
            width: window.innerWidth,
            height: window.innerHeight,
            wireframes: false,
            background: "transparent",
          },
        });

        // Create ground with no friction
        const ground = Bodies.rectangle(
          window.innerWidth / 2,
          window.innerHeight - 20,
          window.innerWidth,
          40,
          {
            isStatic: true,
            friction: 0,
            frictionStatic: 0,
          }
        );

        // Add ground to the world
        Composite.add(engine.world, [ground]);

        // Run the renderer
        Render.run(render);

        // Create runner
        const runner = Runner.create();
        Runner.run(runner, engine);

        // Updated notes sequence
        const beats = [
          "E5",
          "E5",
          "E5", // ^E ^E ^E
          "C5",
          "E5",
          "G5",
          "G4", // ^C ^E ^G G
          "C5",
          "G4",
          "E4", // ^C G E
          "A4",
          "B4",
          "Bb4",
          "A4", // A B Bb A
          "G4",
          "E5",
          "G5",
          "A5", // G ^E ^G ^A
          "F5",
          "G5",
          "E5",
          "C5",
          "D5",
          "B4", // ^F ^G ^E ^C ^D B
          "C5",
          "G4",
          "E4", // ^C G E
          "A4",
          "B4",
          "Bb4",
          "A4", // A B Bb A
          "G4",
          "E5",
          "G5",
          "A5", // G ^E ^G ^A
          "F5",
          "G5",
          "E5",
          "C5",
          "D5",
          "B4", // ^F ^G ^E ^C ^D B
          "G5",
          "F#5",
          "F5",
          "D5",
          "E5", // ^G ^F# ^F ^D ^E
          "G4",
          "A4",
          "C5", // G A ^C
          "A4",
          "C5",
          "D5", // A ^C ^D
          "G5",
          "F#5",
          "F5",
          "D5",
          "E5", // ^G ^F# ^F ^D ^E
          "C6",
          "C6",
          "C6", // *C *C *C
          "G5",
          "F#5",
          "F5",
          "D5",
          "E5", // ^G ^F# ^F ^D ^E
          "G4",
          "A4",
          "C5", // G A ^C
          "A4",
          "C5",
          "D5", // A ^C ^D
          "D#5",
          "D5",
          "C5", // ^D# ^D ^C
          "C5",
          "C5",
          "C5", // ^C ^C ^C
          "C5",
          "D5",
          "E5",
          "C5",
          "A4",
          "G4", // ^C ^D ^E ^C A G
          "C5",
          "C5",
          "C5", // ^C ^C ^C
          "C5",
          "D5",
          "E5", // ^C ^D ^E
          "C5",
          "C5",
          "C5", // ^C ^C ^C
          "C5",
          "D5",
          "E5",
          "C5",
          "A4",
          "G4", // ^C ^D ^E ^C A G
          "E5",
          "E5",
          "E5", // ^E ^E ^E
          "C5",
          "E5",
          "G5",
          "G4", // ^C ^E ^G G
          "C5",
          "G4",
          "E4", // ^C G E
          "A4",
          "B4",
          "Bb4",
          "A4", // A B Bb A
          "G4",
          "E5",
          "G5",
          "A5", // G ^E ^G ^A
          "F5",
          "G5",
          "E5",
          "C5",
          "D5",
          "B4", // ^F ^G ^E ^C ^D B
          "C5",
          "G4",
          "E4", // ^C G E
          "A4",
          "B4",
          "Bb4",
          "A4", // A B Bb A
          "G4",
          "E5",
          "G5",
          "A5", // G ^E ^G ^A
          "F5",
          "G5",
          "E5",
          "C5",
          "D5",
          "B4", // ^F ^G ^E ^C ^D B
          "E5",
          "C5",
          "G4", // ^E-^C G
          "G4",
          "A4",
          "F5",
          "F5",
          "A4", // G A ^F ^F A
          "B4",
          "A5",
          "A5",
          "A5",
          "G5",
          "F5", // B ^A ^A ^A ^G ^F
          "E5",
          "C5",
          "A4",
          "G4", // ^E ^C A G
          "E5",
          "C5",
          "G4", // ^E-^C G
          "G4",
          "A4",
          "F5",
          "F5",
          "A4", // G A ^F ^F A
          "B4",
          "F5",
          "F5",
          "F5",
          "E5",
          "D5",
          "C5", // B ^F ^F ^F ^E ^D ^C
          "G4",
          "E4",
          "C4", // G E C
          "C5",
          "G4",
          "E4", // ^C G E
          "A4",
          "B4",
          "A4", // A B A
          "G#4",
          "Bb4",
          "G#4", // G# Bb G#
          "G4",
          "F#4",
          "G4", // G-F#-G
        ];
        let beatIndex = 0;

        // Create sound objects for each beat
        const soundMap = {
          C4: new Howl({ src: ["sounds/C4.mp3"] }),
          E4: new Howl({ src: ["sounds/E4.mp3"] }),
          G4: new Howl({ src: ["sounds/G4.mp3"] }),
          A4: new Howl({ src: ["sounds/A4.mp3"] }),
          B4: new Howl({ src: ["sounds/B4.mp3"] }),
          Bb4: new Howl({ src: ["sounds/Bb4.mp3"] }),
          C5: new Howl({ src: ["sounds/C5.mp3"] }),
          D5: new Howl({ src: ["sounds/D5.mp3"] }),
          "D#5": new Howl({ src: ["sounds/Eb5.mp3"] }),
          E5: new Howl({ src: ["sounds/E5.mp3"] }),
          F5: new Howl({ src: ["sounds/F5.mp3"] }),
          "F#5": new Howl({ src: ["sounds/Gb5.mp3"] }),
          G5: new Howl({ src: ["sounds/G5.mp3"] }),
          A5: new Howl({ src: ["sounds/A5.mp3"] }),
          C6: new Howl({ src: ["sounds/C6.mp3"] }),
        };

        // Play a sound
        function playSound(note) {
          if (soundMap[note]) {
            soundMap[note].play();
          }
        }

        // Change background color progressively
        function changeBackgroundColor() {
          const step = Math.floor((beatIndex / beats.length) * 255);
          document.body.style.backgroundColor = `rgb(${step}, ${step}, ${step})`;
        }

        // Detect collision with ground
        Events.on(engine, "collisionStart", (event) => {
          const pairs = event.pairs;
          pairs.forEach((pair) => {
            if (
              (pair.bodyA.label === "ball" && pair.bodyB === ground) ||
              (pair.bodyA === ground && pair.bodyB.label === "ball")
            ) {
              if (beatIndex < beats.length) {
                playSound(beats[beatIndex]);
                changeBackgroundColor();
                beatIndex++;
                if (beatIndex >= beats.length) {
                  beatIndex = 0; // Loop the song
                }
              }
            }
          });
        });

        // Function to spawn a new ball at random position
        function spawnBall() {
          const randomX = Math.random() * window.innerWidth;
          const ball = Bodies.circle(randomX, 200, 40, {
            restitution: 1,
            friction: 0,
            frictionStatic: 0,
            density: 0.5,
            label: "ball",
          });
          Composite.add(engine.world, [ball]);
        }

        // Spawn a new ball every second
        setInterval(spawnBall, 3000);
      }

      // Add event listener to the button to start the simulation
      document.getElementById("start-button").addEventListener("click", () => {
        initSimulation();
        document.getElementById("start-button").style.display = "none"; // Hide the button after starting the simulation
      });
    </script>
  </body>
</html>
